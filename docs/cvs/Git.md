**VCS**全称Version Control System，是记录一个或若干文件内容变化，以便将来查阅特定版本修订情况的系统。

| 系统                                                       | 简称 | 描述                                                         |
| ---------------------------------------------------------- | ---- | ------------------------------------------------------------ |
| 本地版本控制系统                                           |      | 复制整个项目目录的方式来保存不同的版本，或许还会改名加上备份时间以示区别 |
| 集中化的版本控制系统（Centralized Version Control System） | CVCS | 有一个单一的集中管理的服务器，保存所有文件的修订版本，而协同工作的人们都通过客户端连到这台服务器，取出最新的文件或者提交更新 |
| 分布式版本控制系统（Distributed Version Control System）   | DVCS | 客户端并不只提取最新版本的文件快照，而是把代码仓库完整地镜像下来 |

### 1. Git原理

- **直接记录快照，而非差异比较**

其它版本控制系统将它们保存的信息看作是一组基本文件和每个文件随时间逐步累积的差异，存储每个文件与初始版本的差异。

![](http://www.yiibai.com/uploads/images/201707/0607/919150744_33189.png)

Git 不按照以上方式对待或保存数据，为了高效，如果文件没有修改，Git 不再重新存储该文件，而是只保留一个链接指向之前存储的文件。

![](http://www.yiibai.com/uploads/images/201707/0607/480150745_86943.png)

- **近乎所有操作本地执行**
- **Git保证完整性**

Git 中所有数据在存储前都计算校验和，然后以校验和来引用。 这意味着不可能在 Git 不知情时更改任何文件内容或目录内容。（Git 用以计算校验和的机制叫做 SHA-1 散列）

- **Git一般只添加数据**
- **三种状态**

| 状态              | 描述                                                       |
| ----------------- | ---------------------------------------------------------- |
| 已提交(committed) | 表示数据已经安全的保存在本地数据库中                       |
| 已修改(modified)  | 表示修改了文件，但还没保存到数据库中                       |
| 已暂存(staged)    | 表示对一个已修改文件的版本做了标记，使之在下次提交的快照中 |

同时引入 Git 项目的三个工作区域的概念

| 工作区   | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| Git 仓库 | 是 用来保存项目的元数据和对象数据库的地方。                  |
| 工作目录 | 是对项目的某个版本独立提取出来的内容，放在磁盘上供你使用或修改 |
| 暂存区域 | 是一个文件，保存了下次将提交的文件列表信息，一般在 Git 仓库目录中 |

**基本的 Git 工作流程如下**：

1. 在工作目录中修改文件。
2. 暂存文件，将文件的快照放入暂存区域。
3. 提交更新，找到暂存区域的文件，将快照永久性存储到 Git 仓库目录。

### 2. Git快速入门

> https://www.yiibai.com/git/git-quick-start.html

- **获取Git仓库**

1. 获取 Git 仓库：`git clone`
2. 现有目录中初始化仓库：`git init`

- **更新提交到仓库**

1. 检查当前文件状态：`git status`
2. 实现对文件的追踪：`git add`（可以使用文件或目录的路径作为参数）
3. 状态简览：`git status -s`或`git status --short`
4. 忽略文件：``
5. 查看已暂存和未暂存的修改：`git diff`
6. 提交更新：`git commit`或`git commit -m`
7. 跳过使用暂存区域：`git commit -a -m`（把所有已经跟踪过的文件暂存起来一并提交，从而跳过 `git add` 步骤）
8. 移除文件：`git rm`
9. 移动文件：`git mv`

- **查看历史提交版本**

1. 查看历史提记录：``git log` `

- **撤销操作**

1. 尝试重新提交信息：`git commit --amend`
2. 取消暂存的文件：`git reset HEAD <file>...`
3. 撤消对文件的修改：`git checkout -- <file>`

- **远程仓库的使用**

1. 查看远程服务器：`git remote`（指定选项 `-v`，会显示读写远程仓库的 Git 保存的简写与其对应的 URL）
2. 添加远程仓库：`git remote add <shortname> <url>`（可以使用`<shortname>`代替`<url>`）
3. 从远程仓库中抓取与拉取：`git fetch [remote-name]`（命令会将数据拉取到本地仓库 - 它并不会自动合并或修改当前的工作）
4. 自动的抓取然后合并远程分支到当前分支：`git pull`
5. 推送到远程仓库：`git push [remote-name] [branch-name]`（只有当你有所克隆服务器的写入权限，并且之前没有人推送过时，这条命令才能生效。 当你和其他人在同一时间克隆，他们先推送到上游然后你再推送到上游，你的推送就会毫无疑问地被拒绝。 你必须先将他们的工作拉取下来并将其合并进你的工作后才能推送。）
6. 查看远程仓库：`git remote show [remote-name]`
7. 重命名仓库引用的名字：`git remote rename [oldname] [newname]`
8. 移除一个远程仓库：`git remote rm [remote-name]`

### 3. Git隐藏(Stash)操作

- 要切换分支以进行客户升级，但不想提交一直在做的工作; 那么可以把当前工作的改变隐藏起来。 要将一个新的存根推到堆栈上，运行`git stash`命令；
- 现在，可以安全地切换分支并在其他地方工作。通过使用`git stash list`命令来查看已存在更改的列表；
- 想要重新开始新的功能的代码编写，查找上次没有写完成的代码，只需执行`git stash pop`命令即可从堆栈中删除更改并将其放置在当前工作目录中。

### 4. Git修正错误

**恢复未提交的更改**

假设我们不小心修改了本地存储库中的一个文件，此时想撤销这些修改。为了处理这种情况，我们可以使用`git checkout`命令。可以使用此命令来还原文件的内容。

`git checkout`命令还可以从本地存储库获取已删除的文件。假设我们从本地存储库中删除一个文件，我们想要恢复这个文件。那么可以通过使用`git checkout`命令来实现这一点。

**删除分段区域的更改**

`git checkout head -- string.py`

**用Git复位移动头指针**

经过少量更改后，可以决定删除这些更改。 `git reset`命令用于复位或恢复更改。

- `--soft`选项：每个分支都有一个`HEAD`指针，它指向最新的提交。它将仅重置`HEAD`指针而不会破坏任何东西；
- `--mixed`选项：将从尚未提交的暂存区域还原这些更改，对文件的工作副本进行的实际更改不受影响；
- `--hard`选项：它会清除分段区域，将HEAD指针重置为特定提交ID的最新提交，并删除本地文件更改。

### 5. Git标签操作

**创建标签**

使用`git tag`命令来标记当前`HEAD`指针。

在创建标签时需要提供`-a`选项指定标签名称，并提供带`-m`选项指定标签消息。

**查看标签**

可以使用带有`-l`选项的`git tag`命令查看所有可用的标签。即`git tag -l`

可使用`git show`命令后跟其标签名来查看有关标签的更多详细信息。

**删除标签**

使用 带有`-d`选项 删除标签：`git tag -d [tag-name]`

### 6. Git补丁操作

**创建补丁**

我们使用`git format-patch`命令创建最新提交的修补程序。 如果要为特定提交创建修补程序，请在`format-patch`命令后面指定 `COMMIT_ID` 。(此命令会在当前工作目录中创建`.patch`文件)

**应用补丁**

其他开发人员可以使用这个补丁来修改他的文件。 Git分别提供两个命令：`git am` 和 `git apply` 来应用补丁。 （`git apply`修改本地文件而不创建提交，而`git am`会修改文件并创建提交）

### 7. Git管理分支

> 分支操作允许创建另一路线/方向上开发。我们可以使用这个操作将开发过程分为两个不同的方向。 例如，我们发布了`1.0`版本的产品，可能需要创建一个分支，以便将`2.0`功能的开发与`1.0`版本中错误修复分开。

**创建分支**

使用`git branch [branch name]`命令创建一个新的分支。可以从现有的分支创建一个新的分支。 也可以使用特定的提交或标签作为起点创建分支。 （默认将以`HEAD`作为起点来创建分支）

**查看分支**

使用`git branch`命令列出可用的分支。

**切换分支**

使用`git checkout`命令在分支之间切换。

其中Git为`checkout`命令提供`-b`选项：此操作将创建一个新的分支，并立即切换到新分支。

**删除分支**

可以通过向`git branch`命令提供`-D`选项来删除分支。 但在删除现有分支之前，请切换到其他分支。

**重命名分支**

那么可通过使用`git branch`命令的`-m`选项后跟旧的分支名称和新的分支名称来更改/重新命名分支名称。

**合并两个分支**

`git merge origin/new_branch`

测试后，就可将代码更改推送到`master`分支了：`git push origin master`

### 8. Git不同平台换行符问题

GNU/Linux和Mac OS使用换行(`LF`)或新行作为行结束字符，而Windows使用换行和回车(`LFCR`)组合来表示行结束字符。为了避免这些行结尾的差异的不必要提交，我们必须配置Git客户端写入与Git仓库使用相同的行结束符。

- 对于Windows系统，可以将Git客户端配置为将行结束符转换为`CRLF`格式，同时退出，并在提交操作时将其转换回`LF`格式：` git config --global core.autocrlf true`
- 对于*GNU/Linux*或*Mac OS*，我们可以配置Git客户端，以便在执行结帐操作时将线结束从CRLF转换为LF：`git config --global core.autocrlf input`

### 9. Git远程操作详解

![](https://www.yiibai.com/uploads/allimg/140613/0A025G34-0.jpg)
